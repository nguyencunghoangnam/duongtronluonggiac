<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Đường tròn lượng giác – gốc 3 (giao diện mới)</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e7f0fd 0%, #fffbe7 100%);
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin-top: 32px;
      margin-bottom: 8px;
      font-size: 2.15rem;
      color: #2563eb;
      font-family: 'Montserrat', sans-serif;
      letter-spacing: 1.2px;
      text-shadow: 0 2px 8px #b6d4fc55;
      font-weight: 700;
      text-align: center;
    }
    .main-frame {
      margin: 28px 0 0 0;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 22px;
      box-shadow: 0 8px 36px rgba(44,62,80,0.12), 0 1.5px 8px rgba(52,152,219,0.08);
      padding: 35px 44px 26px 44px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      background: #fbfcfe;
      border: 2.5px solid #4caf50cc;
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(44, 62, 80, 0.11), 0 0.5px 6px #00bcd430;
      margin-top: 8px;
      transition: box-shadow .16s, transform .15s;
      cursor: pointer;
      max-width: 98vw;
    }
    canvas:active {
      transform: scale(.98);
      box-shadow: 0 3px 10px rgba(44,62,80,0.05);
    }
    #controls {
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 22px;
      width: 100%;
    }
    .row {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
      background: linear-gradient(90deg, #e3f1ff 60%, #f9fbe8 100%);
      border-radius: 14px;
      padding: 18px 22px;
      box-shadow: 0 2px 14px #aed8f633;
      margin-bottom: 0;
      margin-top: 0;
      width: 100%;
      max-width: 660px;
    }
    .row label {
      font-weight: 700;
      color: #1a3356;
      font-size: 1.12rem;
      margin-bottom: 0;
      letter-spacing: 0.2px;
      font-family: 'Montserrat', sans-serif;
    }
    .row input[type=number], .row select {
      width: 110px;
      padding: 7px 9px;
      border-radius: 7px;
      border: 1.6px solid #b8c1ec;
      background: #f6faff;
      font-size: 1.06rem;
      font-family: 'Roboto', Arial, sans-serif;
      margin-right: 7px;
      transition: border 0.22s, box-shadow 0.2s;
      outline: none;
      box-shadow: 0 1.5px 5px #a7e5b420;
      color: #184140;
    }
    .row input[type=number]:focus, .row select:focus {
      border: 1.6px solid #2563eb;
      background: #f0f7ff;
      box-shadow: 0 2px 10px #a7d7ff33;
    }
    #angleLabel {
      font-weight: 700;
      color: #e67e22;
      font-size: 1.08rem;
      margin-left: 12px;
      background: #fffbe9;
      border-radius: 6px;
      padding: 5px 15px 5px 15px;
      font-family: 'Montserrat', Arial, sans-serif;
      box-shadow: 0 1.5px 4px #f5d7b3;
    }
    button {
      margin-top: 6px;
      padding: 11px 34px;
      border: none;
      background: linear-gradient(90deg, #2563eb 60%, #43b047 100%);
      color: #fff;
      border-radius: 10px;
      font-size: 1.13rem;
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 700;
      cursor: pointer;
      letter-spacing: 0.7px;
      box-shadow: 0 8px 22px rgba(44,62,80,0.16), 0 1.5px 8px rgba(52,152,219,0.10);
      transition: background 0.17s, box-shadow 0.13s, transform 0.12s;
    }
    button:hover {
      background: linear-gradient(90deg, #1747b6 60%, #1abc9c 100%);
      box-shadow: 0 12px 30px rgba(44,62,80,0.18);
      transform: translateY(-2px) scale(1.019);
    }
    @media (max-width: 900px) {
      .main-frame { padding: 10px 2vw; }
      canvas { width: 100% !important; height: auto !important; }
      .row { padding: 16px 1vw; }
    }
    @media (max-width: 600px) {
      .main-frame { padding: 0; }
      .row { flex-direction: column; align-items: stretch; gap: 10px; }
      h1 { font-size: 1.35rem; }
      button { width: 100%; }
    }
  </style>
</head>
<body>
  <h1>Đường tròn lượng giác</h1>
  <div class="main-frame">
    <canvas id="circleCanvas" width="700" height="540"></canvas>
    <div id="controls">
      <div class="row">
        <label for="angleInput">Độ (°):</label>
        <input type="number" id="angleInput" value="0" step="1">

        <label for="radInput">Radian:</label>
        <input type="number" id="radInput" value="0" step="0.01">

        <span id="angleLabel">Góc hiện tại: 0° (0.00 rad)</span>
      </div>
      <div class="row">
        <label for="modeSelect">Chế độ so sánh:</label>
        <select id="modeSelect">
          <option value="none">1 góc (mặc định)</option>
          <option value="opposite">Góc đối (α &ndash;α)</option>
          <option value="supplementary">Góc bù (α &amp; π − α)</option>
          <option value="explementary">Hơn kém π (α &amp; α + π)</option>
          <option value="complementary">Góc phụ (α &amp; π/2 − α)</option>
        </select>
      </div>
      <button id="resetBtn">Đặt lại về 0°</button>
    </div>
  </div>
  <script>
    const canvas=document.getElementById('circleCanvas');
    const ctx=canvas.getContext('2d');
    const angleInput=document.getElementById('angleInput');
    const radInput=document.getElementById('radInput');
    const angleLabel=document.getElementById('angleLabel');
    const resetBtn=document.getElementById('resetBtn');
    const modeSelect=document.getElementById('modeSelect');

    const centerX=canvas.width/2,centerY=canvas.height/2,radius=210;
    const innerR=radius*0.2;
    let totalAngle=0,dragging=false,lastRaw=0,ignoreSync=false;

    // Colors
    const colorSin1='#ff9800';
    const colorCos1='#43a047';
    const colorSin2='#ff5722';
    const colorCos2='#3f51b5';
    const colorTanCot='#9c27b0';

    function drawText(text,x,y,align='left'){
      ctx.textAlign=align;
      ctx.font = "16px 'Montserrat', Arial";
      ctx.fillText(text,x,y+4);
      ctx.textAlign='left';
    }

    function drawAngleSector(angleRad, primary=true){
      ctx.save();
      ctx.fillStyle= primary ? 'rgba(25,118,210,0.15)' : 'rgba(0,150,136,0.13)';
      ctx.beginPath();ctx.moveTo(centerX,centerY);
      if(angleRad>=0){ctx.arc(centerX,centerY,innerR,0,-angleRad,true);}
      else{ctx.arc(centerX,centerY,innerR,0,-angleRad,false);}
      ctx.closePath();ctx.fill();ctx.restore();

      // arrow on sector
      const ax=centerX+innerR*Math.cos(angleRad);
      const ay=centerY-innerR*Math.sin(angleRad);
      const arrowLen=14,wing=7;
      let dirX,dirY;
      if(angleRad>=0){dirX=-Math.sin(angleRad);dirY=-Math.cos(angleRad);}
      else{dirX=Math.sin(angleRad);dirY=Math.cos(angleRad);}
      const len=Math.hypot(dirX,dirY);dirX/=len;dirY/=len;
      const bx=ax-dirX*arrowLen,by=ay-dirY*arrowLen;
      ctx.save();
      ctx.strokeStyle= primary ? '#1976d2' : '#009688';
      ctx.fillStyle= ctx.strokeStyle;
      ctx.lineWidth=2;
      ctx.beginPath();ctx.moveTo(bx,by);ctx.lineTo(ax,ay);ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(ax,ay);
      ctx.lineTo(ax-Math.cos(Math.atan2(dirY,dirX)+Math.PI/6)*wing, ay-Math.sin(Math.atan2(dirY,dirX)+Math.PI/6)*wing);
      ctx.lineTo(ax-Math.cos(Math.atan2(dirY,dirX)-Math.PI/6)*wing, ay-Math.sin(Math.atan2(dirY,dirX)-Math.PI/6)*wing);
      ctx.closePath();ctx.fill();ctx.restore();
    }

    function drawSingle(angleDeg, primary=true, labelSuffix=''){
      const angleRad=angleDeg*Math.PI/180;
      const cos=Math.cos(angleRad),sin=Math.sin(angleRad);
      const Mx=centerX+radius*cos,My=centerY-radius*sin,
            Hx=Mx,Hy=centerY,
            Kx=centerX,Ky=My;

      // Sector
      drawAngleSector(angleRad, primary);

      // OM
      ctx.beginPath();ctx.moveTo(centerX,centerY);ctx.lineTo(Mx,My);
      ctx.strokeStyle= primary ? '#1976d2' : '#009688';
      ctx.lineWidth=2.5;ctx.stroke();

      // Point M
      ctx.beginPath();ctx.arc(Mx,My,7,0,2*Math.PI);
      ctx.fillStyle= primary ? '#e53935' : '#00bcd4';
      ctx.shadowColor = primary ? '#ffb3b3' : '#b3f1ff';
      ctx.shadowBlur = 10;
      ctx.fill();
      ctx.shadowBlur = 0;
      drawText('M'+labelSuffix, Mx+16, My-12);

      // Projection H on Ox
      ctx.beginPath();ctx.moveTo(Mx,My);ctx.lineTo(Mx,centerY);
      ctx.strokeStyle= primary ? colorCos1 : colorCos2;ctx.setLineDash([5,3]);ctx.stroke();ctx.setLineDash([]);
      ctx.beginPath();ctx.arc(Hx,Hy,5,0,2*Math.PI);
      ctx.fillStyle= primary ? colorCos1 : colorCos2;ctx.fill();
      drawText('H'+labelSuffix, Hx+14, Hy+20);
      ctx.fillStyle= primary ? colorCos1 : colorCos2;
      drawText(cos.toFixed(3), Hx+14, Hy+40);

      // Projection K on Oy
      ctx.beginPath();ctx.moveTo(Mx,My);ctx.lineTo(centerX,My);
      ctx.strokeStyle= primary ? colorSin1 : colorSin2;ctx.setLineDash([5,3]);ctx.stroke();ctx.setLineDash([]);
      ctx.beginPath();ctx.arc(Kx,Ky,5,0,2*Math.PI);
      ctx.fillStyle= primary ? colorSin1 : colorSin2;ctx.fill();
      drawText('K'+labelSuffix, Kx-22, Ky-14);
      ctx.fillStyle= primary ? colorSin1 : colorSin2;
      drawText(sin.toFixed(3), Kx+28, Ky-14);

      return {sin,cos};
    }

    function getSecondAngle(deg, mode){
      switch(mode){
        case 'opposite': return -deg;
        case 'supplementary': return 180 - deg;
        case 'explementary': return deg + 180;
        case 'complementary': return 90 - deg;
        default: return null;
      }
    }

    function drawScene(angleDeg){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // Circle
      ctx.save();
      ctx.beginPath();ctx.arc(centerX,centerY,radius,0,2*Math.PI);
      ctx.strokeStyle='#333';ctx.lineWidth=2.2;ctx.stroke();
      ctx.restore();

      // Axes with arrows
      ctx.save();
      ctx.beginPath();
      ctx.moveTo(centerX-radius-25,centerY);ctx.lineTo(centerX+radius+25,centerY);
      ctx.moveTo(centerX+radius+18,centerY-7);ctx.lineTo(centerX+radius+25,centerY);ctx.lineTo(centerX+radius+18,centerY+7);
      ctx.moveTo(centerX,centerY-radius-25);ctx.lineTo(centerX,centerY+radius+25);
      ctx.moveTo(centerX-7,centerY-radius-18);ctx.lineTo(centerX,centerY-radius-25);ctx.lineTo(centerX+7,centerY-radius-18);
      ctx.strokeStyle='#888';ctx.lineWidth=1.25;ctx.stroke();
      ctx.restore();

      // Ox positive arrow labelled cos
      ctx.save();
      ctx.strokeStyle='#1976d2';ctx.lineWidth=2.2;
      ctx.beginPath();ctx.moveTo(centerX,centerY);ctx.lineTo(centerX+radius,centerY);ctx.stroke();
      ctx.restore();
      ctx.font='17px Montserrat, Arial';
      ctx.fillStyle=colorCos1;
      ctx.fillText('cos', centerX+radius+35, centerY+7);

      // Oy positive arrow labelled sin
      ctx.font='17px Montserrat, Arial';
      ctx.fillStyle=colorSin1;
      ctx.fillText('sin', centerX-19, centerY-radius-34);

      // Point O
      ctx.beginPath();ctx.arc(centerX,centerY,5,0,2*Math.PI);
      ctx.fillStyle='#000';ctx.shadowColor = '#555';ctx.shadowBlur = 7;
      ctx.fill();
      ctx.shadowBlur = 0;
      drawText('O',centerX-17,centerY+19);

      // Draw first angle (primary)
      const res1 = drawSingle(angleDeg, true, '');

      // Determine and draw second angle if mode selected
      const mode = modeSelect.value;
      const secondAngleDeg = getSecondAngle(angleDeg, mode);
      let res2=null;
      if(secondAngleDeg!==null && mode!=='none'){
        res2 = drawSingle(secondAngleDeg, false, "'");
      }

      // Display numerical values (bottom area)
      ctx.font="17px 'Roboto', Arial";
      const leftX = 24;
      const rightX = canvas.width - 24;

      // Primary angle values (left)
      ctx.fillStyle=colorSin1;
      ctx.fillText(`sin(θ) = ${res1.sin.toFixed(3)}`,leftX,canvas.height-120);
      ctx.fillStyle=colorCos1;
      ctx.fillText(`cos(θ) = ${res1.cos.toFixed(3)}`,leftX,canvas.height-97);

      const EPS=1e-8;
      let tanStr=Math.abs(res1.cos)<EPS?'∞':(res1.sin/res1.cos).toFixed(3);
      let cotStr=Math.abs(res1.sin)<EPS?'∞':(res1.cos/res1.sin).toFixed(3);

      ctx.fillStyle=colorTanCot;
      ctx.fillText(`tan(θ) = ${tanStr}`,leftX,canvas.height-74);
      ctx.fillText(`cot(θ) = ${cotStr}`,leftX,canvas.height-51);

      // Secondary angle values (right) if exists
      if(res2){
        ctx.fillStyle=colorSin2;
        ctx.textAlign='right';
        ctx.fillText(`sin(θ₂) = ${res2.sin.toFixed(3)}`,rightX,canvas.height-120);
        ctx.fillStyle=colorCos2;
        ctx.fillText(`cos(θ₂) = ${res2.cos.toFixed(3)}`,rightX,canvas.height-97);

        let tan2=Math.abs(res2.cos)<EPS?'∞':(res2.sin/res2.cos).toFixed(3);
        let cot2=Math.abs(res2.sin)<EPS?'∞':(res2.cos/res2.sin).toFixed(3);

        ctx.fillStyle=colorTanCot;
        ctx.fillText(`tan(θ₂) = ${tan2}`,rightX,canvas.height-74);
        ctx.fillText(`cot(θ₂) = ${cot2}`,rightX,canvas.height-51);
        ctx.textAlign='left';
      }
    }

    function updateDisplay(){
      ignoreSync=true;
      angleLabel.textContent=`Góc hiện tại: ${Math.round(totalAngle)}° (${(totalAngle*Math.PI/180).toFixed(2)} rad)`;
      angleInput.value=Math.round(totalAngle);
      radInput.value=(totalAngle*Math.PI/180).toFixed(2);
      ignoreSync=false;
      drawScene(totalAngle);
    }

    function getPos(evt){
      const rect=canvas.getBoundingClientRect();
      const clientX=evt.touches?evt.touches[0].clientX:evt.clientX;
      const clientY=evt.touches?evt.touches[0].clientY:evt.clientY;
      return{x:clientX-rect.left,y:clientY-rect.top};
    }

    function rawAngleDeg(pos){
      const dx=pos.x-centerX,dy=centerY-pos.y;
      return Math.atan2(dy,dx)*180/Math.PI;
    }

    function onPointerDown(e){
      const pos=getPos(e);
      const Mx=centerX+radius*Math.cos(totalAngle*Math.PI/180);
      const My=centerY-radius*Math.sin(totalAngle*Math.PI/180);
      const dist=Math.hypot(pos.x-Mx,pos.y-My);
      if(dist<=13){dragging=true;lastRaw=rawAngleDeg(pos);e.preventDefault();}
    }

    function onPointerMove(e){
      if(!dragging)return;
      const pos=getPos(e),newRaw=rawAngleDeg(pos);
      let diff=newRaw-lastRaw;
      if(diff>180)diff-=360;if(diff<-180)diff+=360;
      totalAngle+=diff;lastRaw=newRaw;updateDisplay();e.preventDefault();
    }

    function onPointerUp(){dragging=false;}

    angleInput.addEventListener('input',()=>{
      if(ignoreSync)return;
      ignoreSync=true;totalAngle=parseFloat(angleInput.value)||0;
      radInput.value=(totalAngle*Math.PI/180).toFixed(2);ignoreSync=false;updateDisplay();
    });

    radInput.addEventListener('input',()=>{
      if(ignoreSync)return;
      ignoreSync=true;const rad=parseFloat(radInput.value)||0;
      totalAngle=rad*180/Math.PI;angleInput.value=Math.round(totalAngle);ignoreSync=false;updateDisplay();
    });

    resetBtn.addEventListener('click',()=>{totalAngle=0;updateDisplay();});
    modeSelect.addEventListener('change',updateDisplay);

    canvas.addEventListener('mousedown',onPointerDown);
    canvas.addEventListener('mousemove',onPointerMove);
    window.addEventListener('mouseup',onPointerUp);
    canvas.addEventListener('touchstart',onPointerDown,{passive:false});
    canvas.addEventListener('touchmove',onPointerMove,{passive:false});
    window.addEventListener('touchend',onPointerUp);

    updateDisplay();
  </script>
</body>
</html>
